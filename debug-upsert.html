<!DOCTYPE html>
<html>
<head>
  <title>Debug Supabase Upsert</title>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    // Load from your .env.local
    const supabaseUrl = 'https://ntmiycfydldoremofrbf.supabase.co';
    const supabaseAnonKey = prompt('Paste your VITE_SUPABASE_ANON_KEY:');

    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    console.log('Testing upsert directly...');

    // Test upsert
    const testUpsert = async () => {
      try {
        console.log('Starting upsert...');
        const startTime = Date.now();
        
        const result = await supabase
          .from('users')
          .upsert({
            id: '00000000-0000-0000-0000-000000000000', // Test UUID
            email: 'test@test.com',
            github_username: 'testuser',
            github_avatar_url: 'https://example.com/avatar.jpg',
            last_active: new Date().toISOString(),
          }, {
            onConflict: 'id'
          });

        const endTime = Date.now();
        console.log('Upsert completed in', endTime - startTime, 'ms');
        console.log('Result:', result);
        
        if (result.error) {
          console.error('ERROR:', result.error);
          document.body.innerHTML = '<h1>Error: ' + result.error.message + '</h1><pre>' + JSON.stringify(result.error, null, 2) + '</pre>';
        } else {
          document.body.innerHTML = '<h1>Success!</h1><pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
      } catch (err) {
        console.error('Caught error:', err);
        document.body.innerHTML = '<h1>Caught Error: ' + err.message + '</h1>';
      }
    };

    testUpsert();
  </script>
</head>
<body>
  <h1>Testing Supabase Upsert...</h1>
  <p>Check the console for details.</p>
</body>
</html>

